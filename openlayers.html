<!DOCTYPE html>
<html>
    <head>
    <title>Ashen Empires Map</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv='imagetoolbar' content='no'/>
    <!-- Add Google Fonts for Fredericka the Great -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredericka+the+Great&display=swap" rel="stylesheet">
    
    <style type="text/css"> v\:* {behavior:url(#default#VML);}
        html, body { 
            overflow: hidden; 
            padding: 0; 
            height: 100%; 
            width: 100%; 
            font-family: 'Segoe UI', Geneva, Arial, Verdana, sans-serif;
            margin: 0;
            background: #002131 url('images/bg.png'); /* Background for the entire page */
        }
        
        #container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
        }
        
        h1 { 
            margin: 0; 
            padding: 6px; 
            border: 0; 
            font-size: 20pt; 
            color: white;
        }
        
        #header { 
            padding: 5px 10px; 
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        #subheader { 
            text-align: right; 
            font-size: 10px; 
            color: #ccc;
        }
        
        #map { 
            flex: 1;
            border-radius: 4px;
            background: #002131 url('images/bg.png'); /* Separate background for map */
            overflow: hidden;
        }
        
        #mouse-position {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
        }
        
        /* Make sure the OpenLayers canvas doesn't block the background */
        .ol-layer canvas {
            background-color: transparent;
        }
        
        /* Style the attribution control */
        .ol-attribution {
            background: rgba(0, 0, 0, 0.6) !important;
            color: white !important;
        }
        
        .ol-attribution a {
            color: #9cf !important;
        }
        
        /* Define Fredericka the Great font class */
        .fredericka-the-great-regular {
            font-family: "Fredericka the Great", serif;
            font-weight: 400;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.js"></script>
    <script src="https://unpkg.com/ol-layerswitcher@4.1.1"></script>
    <link rel="stylesheet" href="https://unpkg.com/ol-layerswitcher@4.1.1/src/ol-layerswitcher.css" />
</head>
<body>
    <div id="container">
        <div id="header">
            <h1>Ashen Empires Map</h1>
            <div id="subheader">Created by Sir Chris</div>
        </div>
        <div id="map" class="map"></div>
        <div id="mouse-position"></div>
    </div>
    <script type="text/javascript">
        // Custom coordinate format function to display whole numbers and adjust Y axis
        function customCoordFormat(coord) {
            if (!coord) return '';
            
            // Round to whole numbers
            var x = Math.round(coord[0]);
            
            // For Y, we need to invert the coordinate since OpenLayers has origin at bottom-left
            // and we want origin at top-left
            var y = Math.round(4096 - coord[1]);
            
            // Make sure y is within bounds
            y = Math.max(0, Math.min(4096, y));
            
            // Return formatted string
            return 'X: ' + x + ', Y: ' + y;
        }
        
        // Create a custom mouse position control
        var mousePositionControl = new ol.control.MousePosition({
            className: 'custom-mouse-position',
            target: document.getElementById('mouse-position'),
            coordinateFormat: customCoordFormat,
            undefinedHTML: 'X: 0, Y: 0'
        });
        
        var map = new ol.Map({
            controls: ol.control.defaults.defaults().extend([mousePositionControl]),
            target: 'map',

            layers: [
                new ol.layer.Group({
                    title: 'Overlay',
                    layers: [
                        new ol.layer.Tile({
                            title: 'Overlay',
                            // opacity: 0.7,
                            source: new ol.source.TileImage({
                                attributions: 'Map tiles created by Sir Chris',
                                tileGrid: new ol.tilegrid.TileGrid({
                                    extent: [0,0,4096,4096],
                                    origin: [0,4096],
                                    resolutions: [16,8,4,2,1],
                                    tileSize: [256, 256]
                                }),
                                tileUrlFunction: function(tileCoord) {
                                    return ('./tiles/{z}/{x}/{y}.png'
                                        .replace('{z}', String(tileCoord[0]))
                                        .replace('{x}', String(tileCoord[1]))
                                        .replace('{y}', String(tileCoord[2])));
                                },
                            })
                        }),
                    ]
                }),
            ],
            view: new ol.View({
                center: [1270.000000, 3490.000000], // Center the view on the map
                resolution: 1.000000, // Start at original resolution zoom level
                extent: [0, 0, 4096, 4096], // Set bounds to match the map extent
                constrainOnlyCenter: false, // Constrain both center and extent
                showFullExtent: true // Allow viewing the full extent
            })
        });
        
        // Add a label for Lotor's Summer Palace
        function addLabelFeature() {
            // The coordinates for Lotor's Summer Palace (X: 775, Y: 566)
            // For OpenLayers, we need to use the native coordinate system (y is inverted)
            var x = 775;
            var y = 4096 - 566; // Invert Y coordinate for OpenLayers
            
            // Create a point feature at this location
            var palaceFeature = new ol.Feature({
                geometry: new ol.geom.Point([x, y]),
                name: "Lotor's Summer Palace"
            });
            
            // Create a style for the label with Fredericka the Great font
            var labelStyle = new ol.style.Style({
                text: new ol.style.Text({
                    text: "Lotor's Summer Palace",
                    font: '20px "Fredericka the Great", serif', // Apply Fredericka the Great font
                    fill: new ol.style.Fill({
                        color: '#ffffff'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#000000',
                        width: 1  // 1px border
                    }),
                    textAlign: 'center',
                    textBaseline: 'bottom' // Position text above the point
                })
            });
            
            // Apply the style to the feature
            palaceFeature.setStyle(labelStyle);
            
            // Create a vector source and add the feature
            var vectorSource = new ol.source.Vector({
                features: [palaceFeature]
            });
            
            // Create a vector layer and add it to the map
            var labelLayer = new ol.layer.Vector({
                source: vectorSource,
                title: 'Labels'
            });
            
            // Add the label layer to the map
            map.addLayer(labelLayer);
        }

        // Call the function to add the label
        addLabelFeature();
    </script>
</body>
</html>