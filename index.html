<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Ashen-Empires-Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-mouse-position/src/L.Control.MousePosition.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet-mouse-position/src/L.Control.MousePosition.js"></script>
    <style>
      html, body { 
        width: 100%; 
        height: 100%; 
        margin: 0; 
        padding: 0;
      }
      #map { 
        width: 100%; 
        height: 100%; 
        z-index: 1; 
        background: #002131; 
        background-image: url('images/bg.png');
      }
      #slider { 
        position: absolute; 
        top: 10px; 
        right: 10px; 
        z-index: 999; 
        background: rgba(255, 255, 255, 0.7);
        padding: 5px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <input id="slider" type="range" min="0" max="1" step="0.1" value="1">
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Map configuration
        const mapExtent = [0.00000000, -4096.00000000, 4096.00000000, 0.00000000];
        const mapMinZoom = 0;
        const mapMaxZoom = 4;
        const mapMaxResolution = 1.00000000;
        const mapMinResolution = Math.pow(2, mapMaxZoom) * mapMaxResolution;
        const tileExtent = [0.00000000, -4096.00000000, 4096.00000000, 0.00000000];
        
        // Create custom CRS
        const crs = L.CRS.Simple;
        crs.transformation = new L.Transformation(1, -tileExtent[0], -1, tileExtent[3]);
        crs.scale = function(zoom) {
          return Math.pow(2, zoom) / mapMinResolution;
        };
        crs.zoom = function(scale) {
          return Math.log(scale * mapMinResolution) / Math.LN2;
        };
        
        // Calculate map bounds
        const southWest = crs.unproject(L.point(mapExtent[0], mapExtent[1]));
        const northEast = crs.unproject(L.point(mapExtent[2], mapExtent[3]));
        const bounds = L.latLngBounds(southWest, northEast);
        
        // Initialize map
        const map = new L.Map('map', {
          maxZoom: mapMaxZoom,
          minZoom: mapMinZoom,
          crs: crs,
          maxBounds: bounds,
          maxBoundsViscosity: 1.0 // Makes the bounds completely rigid
        });
        
        // Add tile layer
        const layer = L.tileLayer('tiles/{z}/{x}/{y}.png', {
          minZoom: mapMinZoom,
          maxZoom: mapMaxZoom,
          attribution: 'Created by Sir Chris. Tiled by QGIS Shell',
          noWrap: true,
          tms: false,
          bounds: bounds
        }).addTo(map);
        
        // Fit map to bounds
        map.fitBounds(bounds);
        
        // Add mouse position control
        L.control.mousePosition().addTo(map);
        
        // Opacity slider
        const slider = document.getElementById('slider');
        slider.addEventListener('input', function() {
          layer.setOpacity(this.value);
        });
      });
    </script>
  </body>
</html>
